<?xml version="1.0" encoding="UTF-8"?>

<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="
            http://www.osgi.org/xmlns/blueprint/v1.0.0 
           http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd  
           http://camel.apache.org/schema/blueprint 
           http://camel.apache.org/schema/blueprint/camel-blueprint.xsd"> 


<!-- <blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"  -->


	<bean id="Status" class="by.pauliukevich.service.MyStatus"/>
 

	<bean id="configuration"
		class="org.apache.camel.component.google.mail.GoogleMailConfiguration">
		<property name="applicationName" value="fuse-training" />
		<property name="clientId"
			value="731646980308-sgbkhn645qumoal8mv8oga8i3506f7sq.apps.googleusercontent.com" />
		<property name="clientSecret" value="J30wle93fKNyldAFYKNvpFf0" />
		<property name="refreshToken"
			value="1/-p0d7S6YYyGBHCikBtpnZY1em35VIAOfHWZI5Pt9exxIgOrJDtdun6zK6XiATCKT" />
			 <property name="routeBuilder" ref="myRouteBuilder" />
	</bean>


	<camelContext  id="camel-twitter"
		xmlns="http://camel.apache.org/schema/blueprint" xmlns:movie="http://fabric8.com/examples/movie">

		<propertyPlaceholder location="classpath:twitter.properties"
			id="placeholder" />

		
		<endpoint id="googleMail"
			uri="google-mail://messages/list?userId=pavlukan1983">
		</endpoint>



		<route id="get-file">
			<from
				uri="file:work/twitter-training/input?moveFailed=../failed&amp;move=../processed" />
			<log message="File ${file:name} started processing" />
			<split>
				<xpath>//movie:movie</xpath>
				<setHeader headerName="searchedMovie">
					<xpath resultType="java.lang.String">/movie:movie/@id</xpath>
				</setHeader>
				<setHeader headerName="CamelTwitterKeywords">
					<simple>#${header.searchedMovie}Movie</simple>
				</setHeader>
				<to uri="direct:tweetQueue" />
			</split>
		</route>

		<route id="twitter-search">
			<from uri="direct:tweetQueue" />
			<log
				message="Searching for ${header.searchedMovie} keyword ${header.CamelTwitterKeywords}" />
			<to
				uri="twitter://search?accessToken={{access.token}}&amp;accessTokenSecret={{access.token-secret}}&amp;consumerKey={{consumer.key}}&amp;consumerSecret={{consumer.secret}}" />
			<to uri="bean:Status?method=convertToTweet" />
		</route>

		<route id="twitter-convert">
			<from uri="direct:myTweet"></from>
			<log message="Twitter ${body}" />
			<to uri="mock:test" />
		</route>
	</camelContext>

</blueprint>