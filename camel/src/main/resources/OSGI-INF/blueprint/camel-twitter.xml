<?xml version="1.0" encoding="UTF-8"?>

<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camel="http://camel.apache.org/schema/blueprint"
	xsi:schemaLocation="
           http://www.osgi.org/xmlns/blueprint/v1.0.0 
           http://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd  
           http://camel.apache.org/schema/blueprint 
           http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">



	<bean id="serviceTwitter" class="by.pauliukevich.service.ServiceTwitter" />
	<bean id="serviceGoogleMail" class="by.pauliukevich.service.ServiceGoogleMail" />

	<bean id="google-mail"
		class="org.apache.camel.component.google.mail.GoogleMailComponent">
 		<property name="configuration">
			<bean
				class="org.apache.camel.component.google.mail.GoogleMailConfiguration">
				<property name="applicationName" value="fuse-training" />
				<property name="clientId"
					value="594101008393-rsnne6l1qg8b8cdlv0plkm68fm9en4st.apps.googleusercontent.com " />
				<property name="clientSecret" value="TGAxAjl4Agk00afrBzSuymmK" />
				<property name="refreshToken"
					value="1/9-79stiSeO6wpzEndiR-5QSnfRQIHX3dTHN2IAHgSsdIgOrJDtdun6zK6XiATCKT" />
				<property name="accessToken" value="ya29.2gHJivYDH2Es9qqkegnQpT00G9xonUUPMzIPlA11HU5oYKqE5bRJtvCgRB8CJeXdcBw_1" />
			</bean>
		</property>
	</bean>


	<camelContext id="camel-twitter"
		xmlns="http://camel.apache.org/schema/blueprint" xmlns:movie="http://fabric8.com/examples/movie">


<!-- 
<properties>
        <property key="http.proxyHost" value="10.182.1.49"/>
        <property key="http.proxyPort" value="80"/>
   </properties>
 -->


		<propertyPlaceholder location="classpath:twitter.properties"
			id="placeholder" />

<!-- 
		<route id="googleTest">
			<from uri="google-mail://messages/list?userId=me&amp;consumer.delay=50000" />
			<log message="Google mail request ${body}" />
			<to uri="bean:serviceGoogleMail?method=convertToModel" />
		</route>
 -->


		<route id="get-file">
			<from
				uri="file:work/twitter-training/input?moveFailed=../failed&amp;move=../processed" />
			<log message="File ${file:name} started processing" />
			<split>
				<xpath>//movie:movie</xpath>
				<setHeader headerName="searchedMovie">
					<xpath resultType="java.lang.String">/movie:movie/@id</xpath>
				</setHeader>
				<setHeader headerName="CamelTwitterKeywords">
					<simple>#${header.searchedMovie}Movie</simple>
				</setHeader>
				<to uri="direct:tweetQueue" />
			</split>
		</route>

		<route id="twitter-search">
			<from uri="direct:tweetQueue" />
			<log
				message="Searching for ${header.searchedMovie} keyword ${header.CamelTwitterKeywords}" />
			<to
				uri="twitter://search?accessToken={{access.token}}&amp;accessTokenSecret={{access.token-secret}}&amp;consumerKey={{consumer.key}}&amp;consumerSecret={{consumer.secret}}" />
			<to uri="bean:serviceTwitter?method=convertToModel" />
		</route>

		<route id="twitter-convert">
			<from uri="direct:myModel"></from>
			<log message="ModelMessage ${body}" />
			<to uri="mock:test" />
		</route>
	</camelContext>

</blueprint>